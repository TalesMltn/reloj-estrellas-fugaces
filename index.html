<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Universo TRON</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      overflow: hidden;
      height: 100%;
      width: 100%;
      background: url('space.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Orbitron', sans-serif;
    }

    #fondo, #three-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    #fondo { z-index: 1; pointer-events: none; }
    #three-canvas { z-index: 2; }

    #info-hora {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 4vw;
      font-weight: bold;
      padding: 15px 30px;
      border-radius: 15px;
      color: #00FFFF;
      text-shadow: 0 0 10px #00FFFF, 0 0 20px #00FFFF;
      background: rgba(0, 255, 255, 0.05);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 255, 255, 0.3);
      animation: pulso 2s infinite;
      z-index: 3;
    }

    #start-audio {
      position: absolute;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      background: #000;
      border: 2px solid #00ffff;
      color: #00ffff;
      padding: 10px 20px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      cursor: pointer;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
      z-index: 3;
    }
    #fecha-tron {
      position: absolute;
      bottom: 20px;
      right: 30px;
      color: #00ffff;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      background: rgba(0, 255, 255, 0.08);
      padding: 10px 16px;
      border: 1px solid #00ffff;
      border-radius: 8px;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
      z-index: 3;
    }
  </style>
</head>
<body>
  <div id="info-hora"></div>
  <div id="fecha-tron"></div>
  <button id="start-audio">Iniciar música</button>
  <audio id="sonido" src="sonido.mp3" preload="auto" loop></audio>

  <canvas id="fondo"></canvas>

  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>

  <script>
    // ───── Reloj TRON ─────
    const reloj = document.getElementById('info-hora');
    function actualizarHora() {
      const ahora = new Date();
      const h = String(ahora.getHours()).padStart(2, '0');
      const m = String(ahora.getMinutes()).padStart(2, '0');
      const s = String(ahora.getSeconds()).padStart(2, '0');
      reloj.textContent = `${h}:${m}:${s}`;
      if (ahora.getSeconds() % 2 === 0) {
        reloj.style.color = '#00ffff';
        reloj.style.textShadow = '0 0 10px #00ffff, 0 0 20px #00ffff';
      } else {
        reloj.style.color = '#ff5f00';
        reloj.style.textShadow = '0 0 10px #ff5f00, 0 0 20px #ff5f00';
      }
    }
    setInterval(actualizarHora, 1000);
    actualizarHora();

    // ───── Estrellas Fugaces ─────
    const canvas = document.getElementById('fondo');
    const ctx = canvas.getContext('2d');
    let width = canvas.width = window.innerWidth;
    let height = canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    class EstrellaFugaz {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * width;
        this.y = Math.random() * height / 2;
        this.len = 100 + Math.random() * 50;
        this.speed = 4 + Math.random() * 6;
        this.angle = Math.PI / 4;
        this.alpha = 0.8 + Math.random() * 0.2;
      }
      update() {
        this.x += this.speed * Math.cos(this.angle);
        this.y += this.speed * Math.sin(this.angle);
        if (this.x > width || this.y > height) this.reset();
      }
      draw() {
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x - this.len * Math.cos(this.angle), this.y - this.len * Math.sin(this.angle));
        ctx.strokeStyle = `rgba(255,255,255,${this.alpha})`;
        ctx.lineWidth = 2;
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#ffffff';
        ctx.stroke();
      }
    }

    const estrellas = Array.from({ length: 30 }, () => new EstrellaFugaz());
    function animarEstrellas() {
      ctx.clearRect(0, 0, width, height);
      estrellas.forEach(e => { e.update(); e.draw(); });
      requestAnimationFrame(animarEstrellas);
    }
    animarEstrellas();

    // ───── Three.js Luna ─────
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
    camera.position.z = 3;

    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(width, height);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.domElement.id = 'three-canvas';
    document.body.appendChild(renderer.domElement);

    const moonTexture = new THREE.TextureLoader().load('moon.jpg');
    const moon = new THREE.Mesh(
      new THREE.SphereGeometry(1, 32, 32),
      new THREE.MeshStandardMaterial({ map: moonTexture })
    );
    moon.castShadow = true;
    moon.receiveShadow = true;
    scene.add(moon);

    const light = new THREE.PointLight(0xffffff, 1.5, 100);
    light.position.set(5, 5, 5);
    light.castShadow = true;
    light.shadow.mapSize.set(1024, 1024);
    light.shadow.radius = 4;
    scene.add(light);

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambientLight);

    const shadowPlane = new THREE.Mesh(
      new THREE.PlaneGeometry(10, 10),
      new THREE.ShadowMaterial({ opacity: 0.3 })
    );
    shadowPlane.rotation.x = -Math.PI / 2;
    shadowPlane.position.y = -1;
    shadowPlane.receiveShadow = true;
    scene.add(shadowPlane);

    function actualizarHora() {
      const ahora = new Date();
      const horas = ahora.getHours().toString().padStart(2, '0');
      const minutos = ahora.getMinutes().toString().padStart(2, '0');
      const segundos = ahora.getSeconds().toString().padStart(2, '0');
      document.getElementById('info-hora').textContent = `${horas}:${minutos}:${segundos}`;
    }
    setInterval(actualizarHora, 1000);
    actualizarHora();

    function actualizarFecha() {
      const fechaActual = new Date();
      const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const fechaFormateada = fechaActual.toLocaleDateString('es-PE', opciones);
      document.getElementById('fecha-tron').textContent = fechaFormateada;
    }
    actualizarFecha();
    
    function animarLuna() {
      requestAnimationFrame(animarLuna);
      moon.rotation.y += 0.005;
      moon.rotation.x += 0.002;
      renderer.render(scene, camera);
    }
    animarLuna();
    
    // ───── Audio ─────
    const audio = document.getElementById('sonido');
    const btnStart = document.getElementById('start-audio');
    btnStart.addEventListener('click', () => {
      audio.play().then(() => {
        btnStart.style.display = 'none';
      }).catch(err => console.error('Audio error:', err));
    });
  </script>
  <div id="fecha-tron"></div>
</body>
</html>